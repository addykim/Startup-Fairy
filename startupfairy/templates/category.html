{% extends "base.html" %}
{% set active_page = title %}
{% block content %}
  <div class="col-md-8 col-md-offset-2">
    <h1 id="category-header">
    {% if alt_title %}{{ alt_title }}{% else %}{{ title.capitalize()}} {% endif %}</h1>
    <div id='table-content'></div>
    <script type="text/javascript" src="{{url_for('static', filename='bower_components/griddle-react/build/Griddle.js')}}"></script>
    <!-- <script type="text/babel" src="{{url_for('static', filename='js/table.js')}}"></script> -->
     <script type="text/babel">

      var data = {{ data|tojson }};
      var category = document.getElementById('category-header').innerHTML.toLowerCase().trim();
      var columns, columnMetadata;


      var WebsiteLink = React.createClass({
        render: function(){
          return <a href={this.props.data}>{this.props.data}</a>
        }
      });

      var EntityLink = React.createClass({
        render: function(){
          var name = this.props.data;
          if (name.length > 0 && name instanceof Array) {
            name = name[0]
          }
          name = name.toString().split(" ").join("");
          var url = this.props.metadata.customHeaderComponentProps.link + name;
          return <a href={url}>{this.props.data}</a>
        }
      });
      switch(category) {
          case 'people':
            columns = ["name", "city", "role"];
            columnMetadata = [{
              "columnName": "name",
              "order": 1,
              "locked": true,
              "displayName": "Name",
              "customComponent": EntityLink,
              "customHeaderComponentProps": { link: 'people/' }
            }, {
              "columnName": "city",
              "order": 2,
              "locked": false,
              "displayName": "City",
              "customComponent": EntityLink,
              "customHeaderComponentProps": { link: 'cities/' }
            }, {
              "columnName": "role",
              "order": 4,
              "locked": false,
              "displayName": "Roles"
            }, {
              "columnName": "summary",
              "visible": false
            }, {
              "columnName": "twitter",
              "visible": false,
            }];
            break;
          case 'companies':
            columns = ["name", "website", "city"];
            columnMetadata = [
            {
              "columnName": "name",
              "order": 1, 
              "displayName": "Name",
              "customComponent": EntityLink,
              "customHeaderComponentProps": { link: 'companies/' }
            }, {
              "columnName": "city",
              "visible": true,
              "order": 2,
              "displayName": "City",
              "customComponent": EntityLink,
              "customHeaderComponentProps": { link: 'cities/' }
            }, {
              "columnName": "investors",
              "order": 4,
              "displayName": "Investors",
              "customComponent": EntityLink,
              "customHeaderComponentProps": { link: 'financialorgs/' }
            }, {
              "columnName": "employees", 
              "visible": true,
              "order": 3,
              "displayName": "Employees",
              "customComponent": EntityLink,
              "customHeaderComponentProps": { link: 'people/' }
            }, {
              "columnName": "website",
              "order": 1,
              "displayName": "Website",
              "customComponent": WebsiteLink
            }, {
              "columnName": "twitter_username",
              "visible": false
            }];
            break;
          case 'financial organizations':
          case 'financialorgs':
            columns = ["name", "city", "website"];
            columnMetadata = [{
              "columnName": "name",
              "locked": true,
              "displayName": "Name",
              "customComponent": EntityLink,
              "customHeaderComponentProps": { link: 'financialorgs/' }
            }, {
              "columnName": "city",
              "displayName": "Location",
              "customComponent": EntityLink,
              "customHeaderComponentProps": { link: 'cities/' }
            }, {
              "columnName": "website",
              "displayName": "Website",
              "customComponent": WebsiteLink
            }, {
              "columnName": "twitter",
              "visible": false
            }, {
              "columnName": "summary",
              "visible": false
            }];
            break;
          case 'cities':
            columns = ["name", "state", "companies", "financial_orgs", "people"];
            columnMetadata = [{
              "columnName": "name",
              "order": 2,
              "displayName": "Name",
              "customComponent": EntityLink,
              "customHeaderComponentProps": { link: 'cities/' }
            }, {
              "columnName": "state",
              "order": 3,
              "displayName": "State"
            }, {
              "columnName": "companies",
              "displayName": "Companies",
              "customComponent": EntityLink,
              "customHeaderComponentProps": { link: 'companies/' }
            }, {
              "columnName": "financial_orgs",
              "displayName": "Financial Organizations",
              "customComponent": EntityLink,
              "customHeaderComponentProps": { link: 'financialorgs/' }
            }, {
              "columnName": "people",
              "displayName": "People",
              "customComponent": EntityLink,
              "customHeaderComponentProps": { link: 'people/' }
            }];
            break;
          default:
            // if we hit this case, we need to create a new list
            columns = undefined;
      }

      ReactDOM.render(
        <Griddle results={data} showSettings={false} columns={columns} columnMetadata={columnMetadata}/>,
        document.getElementById('table-content')
      );
     </script>
	</div>
{% endblock %}
